<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Sample</title>
</head>
<body>
	<select id="api-method">
		<option value="GET">GET</option>
		<option value="POST" selected>POST</option>
		<option value="PUT">PUT</option>
		<option value="PATCH">PATCH</option>
		<option value="DELETE">DELETE</option>
	</select>
	<input type="text" id="api-url" placeholder="API URL" value="/api/login">
	<br />
	<form id="my-form" method="POST">


		<div id="form-inputs">
			<h2>Signin</h2>
			<input type="text" name="email" placeholder="email" value="admin@cbsua.edu.ph" required><br />
			<input type="password" name="password" placeholder="Password"><br />
		</div>


		<input type="submit">
	</form>
	<div id="progress" hidden>
		Processing...
	</div>
	<pre id="api-response"></pre>
	<script type="text/javascript">
		const myForm = document.getElementById("my-form");
		const progress = document.getElementById("progress");
		const apiMethodId = document.getElementById("api-method");
		const apiResponse = document.getElementById("api-response");

		apiMethodId.addEventListener("change", () => {
			apiResponse.toggleAttribute("hidden", true);
			const formInputs = document.getElementById("form-inputs");
			if (apiMethodId.value == "GET") {
				formInputs.toggleAttribute("hidden", true);
			} else {
				formInputs.toggleAttribute("hidden", false);
			}
		});

		myForm.addEventListener("submit", async (e) => {
		    e.preventDefault();
		    progress.toggleAttribute("hidden", false);
		    apiResponse.toggleAttribute("hidden", true);
		    const formData = new FormData(e.target); // new FormData(myForm);
		    const data = {};
		    for (const [key, value] of formData) {
		    	data[key] = formData.getAll(key).length > 1 ? formData.getAll(key) : value;
		    }
		    try {
		    	let apiHeaders = {};
		    	if (apiMethodId.value == "GET") {
		    		apiHeaders = {
			            method: "GET",
			            credentials: 'include',
			        }
		    	} else {
		    		apiHeaders = {
			            method: apiMethodId.value,
			            credentials: 'include',
			            headers: {
			                "Content-Type": "application/json",
			            },
			            body: JSON.stringify(data) // body: JSON.stringify(formData)
			        }
		    	}
		    	const apiUrl = document.getElementById("api-url").value;
		        const response = await fetch(apiUrl, apiHeaders);
		        const text = await response.text();
		        const jsonData = JSON.parse(text);
		        apiResponse.innerHTML = `<h3>API Response: ${response.status}</h3>${text}`;
		    } catch (error) {
		        apiResponse.innerHTML = `<h3>An unexpected error occurred:</h3>${error}`;
		    }
		    progress.toggleAttribute("hidden", true);
		    apiResponse.toggleAttribute("hidden", false);
		});
	</script>
</body>
</html>